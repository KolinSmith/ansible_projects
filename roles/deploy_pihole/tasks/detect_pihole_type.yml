---
# Detect if Pi-hole is Docker-based or traditional installation

- name: Check if docker-compose.yml exists for Pi-hole
  stat:
    path: "/home/{{ ansible_user }}/code_base/docker_projects/{{ inventory_hostname | lower }}/docker-compose.yml"
  register: pihole_docker_compose
  failed_when: false

- name: Check if Pi-hole container is running (if docker-compose exists)
  command: "docker ps --filter 'name=pihole-{{ inventory_hostname | lower }}' --format '{{ '{{' }}.Names{{ '}}' }}'"
  register: pihole_container
  failed_when: false
  changed_when: false
  when: pihole_docker_compose.stat.exists

- name: Set Pi-hole deployment type
  set_fact:
    pihole_is_docker: "{{ pihole_docker_compose.stat.exists and pihole_container.stdout != '' }}"
    pihole_container_name: "pihole-{{ inventory_hostname | lower }}"

- name: Display Pi-hole deployment type
  debug:
    msg: "Pi-hole deployment type: {{ 'Docker-based' if pihole_is_docker else 'Traditional installation' }}"
